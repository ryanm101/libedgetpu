name: Validate
on: [workflow_call]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Build Docker Image
      run: docker build -t tpubuilder --build-arg IMAGE=ubuntu:18.04 ./docker

    - name: Run Build in Custom Docker Container
      env:
        CPU: "k8"
        DOCKER_CPUS: "k8"
        DOCKER_IMAGE: "ubuntu:18.04"
        DOCKER_TARGETS: libedgetpu
      run: |
        make docker-build

    - name: Upload Build artifact
      uses: actions/upload-artifact@v3
      with:
        name: drivers
        path: bazel-out
        retention-days: 1